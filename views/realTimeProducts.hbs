<section class="container container-mid">
  <h1 class="page-title">⚡ Productos en Tiempo Real</h1>

  <div class="grid-two">
    <div class="card p-1r" style="box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
      <h3 class="card-title" style="margin-bottom: 0.5rem;">Agregar producto</h3>
      <form id="addForm" onsubmit="return false;">
        <input id="title" placeholder="Título" class="form-control" style="margin:.25rem 0;">
        <input id="code" placeholder="Código" class="form-control" style="margin:.25rem 0;">
        <input id="price" type="number" placeholder="Precio" class="form-control" style="margin:.25rem 0;">
        <input id="stock" type="number" placeholder="Stock" class="form-control" style="margin:.25rem 0;">
        <input id="category" placeholder="Categoría" class="form-control" style="margin:.25rem 0;">
        <textarea id="description" placeholder="Descripción" class="form-control" style="margin:.25rem 0;"></textarea>
        <button onclick="submitAdd()" class="btn btn-success w-100">Agregar</button>
      </form>

  <h3 class="card-title" style="margin:1rem 0 .5rem;">Eliminar producto</h3>
      <input id="deleteId" placeholder="ID del producto" class="form-control" style="margin:.25rem 0;">
      <button onclick="submitDelete()" class="btn btn-danger w-100">Eliminar</button>
    </div>

    <div class="card p-1r" style="box-shadow: 0 4px 12px rgba(0,0,0,0.05);">
      <h3 class="card-title">Listado</h3>
      <div id="list" class="grid-cards"></div>
    </div>
  </div>
</section>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

socket.on('products', (items) => {
  const list = document.getElementById('list');
  list.innerHTML = items.map(p => `
    <div class="mini-card">
      <div class="mini-title">${p.title}</div>
      <div class="mini-price">$${p.price}</div>
      <div class="mini-id">ID: ${p._id || p.id}</div>
    </div>
  `).join('');
});

socket.on('error', (e) => alert(e.message || 'Error'));

function submitAdd() {
  const prod = {
    title: document.getElementById('title').value,
    code: document.getElementById('code').value,
    price: document.getElementById('price').value,
    stock: document.getElementById('stock').value,
    category: document.getElementById('category').value,
    description: document.getElementById('description').value
  };
  socket.emit('addProduct', prod);
}

function submitDelete() {
  const id = document.getElementById('deleteId').value;
  socket.emit('deleteProduct', id);
}
</script>
