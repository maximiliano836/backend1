<div class="container container-900">
  <div class="row-between mb-2r">
    <h1 class="page-title" style="margin:0;">üõí Mi Carrito</h1>
    <a href="/products" class="btn-primary" style="text-decoration: none; padding: 10px 20px; border-radius: 6px;">
      ‚Üê Seguir Comprando
    </a>
  </div>

  {{#if cart.products.length}}
  <div class="stack mb-2r">
    {{#each cart.products}}
      {{#if this.product}}
      <div class="card" style="display:flex;justify-content:space-between;align-items:center;border:1px solid #eee;padding:15px;">
        <div style="flex:1;">
          <div style="font-weight:600;font-size:1.1rem;color:#333;margin-bottom:0.5rem;">
            {{this.product.title}}
          </div>
          <div style="color:#666;margin-bottom:0.5rem;">
            {{this.product.description}}
          </div>
          <div style="font-size:.9rem;color:#666;">
            Cantidad: {{this.quantity}} √ó ${{this.product.price}}
          </div>
        </div>
        <div style="text-align:right;">
          <div class="price" style="font-size:1.2rem;">
            ${{multiply this.quantity this.product.price}}
          </div>
          <button onclick="removeFromCart('{{toString this.product._id}}')" class="btn btn-danger btn-sm" style="margin-top:0.5rem;">
            Eliminar
          </button>
        </div>
      </div>
      {{else}}
      <div class="alert" style="background:#ffebee;border:1px solid #e57373;border-radius:8px;padding:15px;">
        <strong>Producto no encontrado</strong> - Cantidad: {{this.quantity}} - ID: {{toString this.product}}
      </div>
      {{/if}}
    {{/each}}
  </div>
  
  <div class="total-box">
    <h3 class="page-title" style="margin:0;">
      Total: $<span id="cart-total">{{calculateTotal cart.products}}</span>
    </h3>
  </div>
  
  {{else}}
    <div class="empty">
      <h3 class="text-muted">No hay productos en tu carrito</h3>
      <p class="text-light" style="margin:1rem 0;">¬°Explora nuestro cat√°logo y encuentra productos incre√≠bles!</p>
      <a href="/products" class="btn btn-success" style="text-decoration:none;padding:12px 24px;border-radius:6px;">
        Ver Productos
      </a>
    </div>
  {{/if}}
</div>

<script>
async function removeFromCart(productId) {
  const cartId = '{{toString cart._id}}';
  try {
    const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
      method: 'DELETE'
    });
    
    if (response.ok) {
      alert('Producto eliminado del carrito');
      location.reload(); 
    } else {
      alert('Error al eliminar producto');
    }
  } catch (error) {
    alert('Error al eliminar producto');
  }
}
</script>
