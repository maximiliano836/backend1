<div class="container" style="max-width:900px;margin:0 auto;padding:2rem;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1 style="color:#667eea;margin:0;">üõí Mi Carrito</h1>
    <a href="/products" style="background: #667eea; color: white; text-decoration: none; padding: 10px 20px; border-radius: 6px;">
      ‚Üê Seguir Comprando
    </a>
  </div>

  {{#if cart.products.length}}
  <div style="display:grid;gap:15px;margin-bottom:2rem;">
    {{#each cart.products}}
      {{#if this.product}}
      <div style="display:flex;justify-content:space-between;align-items:center;background:#fff;border:1px solid #eee;border-radius:8px;padding:15px;box-shadow:0 2px 4px rgba(0,0,0,0.1);">
        <div style="flex:1;">
          <div style="font-weight:600;font-size:1.1rem;color:#333;margin-bottom:0.5rem;">
            {{this.product.title}}
          </div>
          <div style="color:#666;margin-bottom:0.5rem;">
            {{this.product.description}}
          </div>
          <div style="font-size:.9rem;color:#666;">
            Cantidad: {{this.quantity}} √ó ${{this.product.price}}
          </div>
        </div>
        <div style="text-align:right;">
          <div style="color:#667eea;font-weight:600;font-size:1.2rem;">
            ${{multiply this.quantity this.product.price}}
          </div>
          <button onclick="removeFromCart('{{toString this.product._id}}')" 
                  style="background:#e53e3e;color:white;border:none;padding:5px 10px;border-radius:4px;font-size:0.8rem;margin-top:0.5rem;cursor:pointer;">
            Eliminar
          </button>
        </div>
      </div>
      {{else}}
      <div style="background:#ffebee;border:1px solid #e57373;border-radius:8px;padding:15px;">
        <strong>Producto no encontrado</strong> - Cantidad: {{this.quantity}} - ID: {{toString this.product}}
      </div>
      {{/if}}
    {{/each}}
  </div>
  
  <div style="background:#f8f9ff;border:2px solid #667eea;border-radius:8px;padding:20px;text-align:center;">
    <h3 style="color:#667eea;margin:0;">
      Total: $<span id="cart-total">{{calculateTotal cart.products}}</span>
    </h3>
  </div>
  
  {{else}}
    <div style="text-align:center;padding:3rem;">
      <h3 style="color:#666;">No hay productos en tu carrito</h3>
      <p style="color:#999;margin:1rem 0;">¬°Explora nuestro cat√°logo y encuentra productos incre√≠bles!</p>
      <a href="/products" style="background:#48bb78;color:white;text-decoration:none;padding:12px 24px;border-radius:6px;">
        Ver Productos
      </a>
    </div>
  {{/if}}
</div>

<script>
async function removeFromCart(productId) {
  const cartId = '{{toString cart._id}}';
  try {
    const response = await fetch(`/api/carts/${cartId}/products/${productId}`, {
      method: 'DELETE'
    });
    
    if (response.ok) {
      alert('Producto eliminado del carrito');
      location.reload(); 
    } else {
      alert('Error al eliminar producto');
    }
  } catch (error) {
    alert('Error al eliminar producto');
  }
}
</script>
